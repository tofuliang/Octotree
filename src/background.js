(()=>{"use strict";"browser"in self||(self.browser=self.chrome);const t=/^(https?|wss?|file|ftp|\*):\/\/(\*|\*\.[^*/]+|[^*/]+)\/.*$|^file:\/\/\/.*$|^resource:\/\/(\*|\*\.[^*/]+|[^*/]+)\/.*$|^about:/,e="object"==typeof navigator&&navigator.userAgent.includes("Firefox/"),n=e?/^(https?|wss?):[/][/][^/]+([/].*)?$/:/^https?:[/][/][^/]+([/].*)?$/,o=/^(https?|file|ftp):[/]+/;function r(...r){return 0===r.length?/$./:r.includes("<all_urls>")?o:r.includes("*://*/*")?n:new RegExp(r.map((n=>function(n){if(!t.test(n))throw new Error(n+" is an invalid pattern, it must match "+String(t));let[,o,r,i]=n.split(/(^[^:]+:[/][/])([^/]+)?/);return o=o.replace("*",e?"(https?|wss?)":"https?").replace(/[/]/g,"[/]"),r=(null!=r?r:"").replace(/^[*][.]/,"([^/]+.)*").replace(/^[*]$/,"[^/]+").replace(/[.]/g,"[.]").replace(/[*]$/g,"[^.]+"),i=i.replace(/[/]/g,"[/]").replace(/[.]/g,"[.]").replace(/[*]/g,".*"),"^"+o+r+"("+i+")?$"}(n))).join("|"))}function i(){return function(t){var e,n,o;const r={origins:[],permissions:[]},i=new Set([...null!==(e=t.permissions)&&void 0!==e?e:[],...(null!==(n=t.content_scripts)&&void 0!==n?n:[]).flatMap((t=>{var e;return null!==(e=t.matches)&&void 0!==e?e:[]}))]);t.devtools_page&&!(null===(o=t.optional_permissions)||void 0===o?void 0:o.includes("devtools"))&&i.add("devtools");for(const t of i)t.includes("://")?r.origins.push(t):r.permissions.push(t);return r}(chrome.runtime.getManifest())}const s=/:[/][/][*.]*([^/]+)/;function a(t){return t.split(s)[1]}const c=globalThis.chrome&&new function t(e){return new Proxy(e,{get(e,n){if(e[n])return"function"!=typeof e[n]?new t(e[n]):(...t)=>new Promise(((o,r)=>{e[n](...t,(t=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):o(t)}))}))}})}(globalThis.chrome),l=Boolean(globalThis.chrome?.scripting);function u(t){return Array.isArray(t)?t:[t]}function m(t){return void 0===t?void 0:[t]}async function d({tabId:t,frameId:e,files:n,allFrames:o,matchAboutBlank:r,runAt:i},{ignoreTargetErrors:s}={}){const a=Promise.all(n.map((async n=>("string"==typeof n&&(n={file:n}),l?chrome.scripting.insertCSS({target:{tabId:t,frameIds:m(e),allFrames:void 0===e?o:void 0},files:"file"in n?[n.file]:void 0,css:"code"in n?n.code:void 0}):c.tabs.insertCSS(t,{...n,matchAboutBlank:r,allFrames:o,frameId:e,runAt:i??"document_start"})))));s?await g(a):await a}async function p({tabId:t,frameId:e,files:n,allFrames:o,matchAboutBlank:r,runAt:i},{ignoreTargetErrors:s}={}){const a=n.map((t=>"string"==typeof t?{file:t}:t));if(l){!function(t){if(t.some((t=>"code"in t)))throw new Error("chrome.scripting does not support injecting strings of `code`")}(a);const n=chrome.scripting.executeScript({target:{tabId:t,frameIds:m(e),allFrames:void 0===e?o:void 0},files:a.map((({file:t})=>t))});return void(s?await g(n):await n)}const u=[];for(const n of a)"code"in n&&await u.at(-1),u.push(c.tabs.executeScript(t,{...n,matchAboutBlank:r,allFrames:o,frameId:e,runAt:i}));s?await g(Promise.all(u)):await Promise.all(u)}async function f(t,e,n={}){const o=u(t);await Promise.all(o.map((async t=>async function({frameId:t,tabId:e,allFrames:n},o,r={}){const i=u(o).flatMap((o=>[d({tabId:e,frameId:t,allFrames:n,files:o.css??[],matchAboutBlank:o.matchAboutBlank??o.match_about_blank,runAt:o.runAt??o.run_at},r),p({tabId:e,frameId:t,allFrames:n,files:o.js??[],matchAboutBlank:o.matchAboutBlank??o.match_about_blank,runAt:o.runAt??o.run_at},r)]));await Promise.all(i)}(function(t){return"object"==typeof t?{...t,allFrames:!1}:{tabId:t,frameId:void 0,allFrames:!0}}(t),e,n))))}const h=/^No frame with id \d+ in tab \d+.$|^No tab with id: \d+.$|^The tab was closed.$|^The frame was removed.$/;async function g(t){try{await t}catch(t){if(!h.test(t?.message))throw t}}const w="Type error for parameter contentScriptOptions (Error processing matches: Array requires at least 1 items; you have 0) for contentScripts.register.",b="Permission denied to register a content script for ",y="object"==typeof chrome&&"webNavigation"in chrome;const v=globalThis.chrome?.scripting?.registerContentScripts,x=globalThis.browser?.contentScripts?.register;async function k(t){if(v){const e="webext-dynamic-content-script-"+JSON.stringify(t);try{await v([{...t,id:e}])}catch(t){if(!t?.message.startsWith("Duplicate script ID"))throw t}return{unregister:async()=>chrome.scripting.unregisterContentScripts({ids:[e]})}}const e={...t,js:t.js?.map((t=>({file:t}))),css:t.css?.map((t=>({file:t})))};return x?x(e):async function(t,e){const{js:n=[],css:o=[],matchAboutBlank:i,matches:s=[],excludeMatches:a,runAt:l}=t;let{allFrames:u}=t;if(y?u=!1:u&&console.warn("`allFrames: true` requires the `webNavigation` permission to work correctly: https://github.com/fregante/content-scripts-register-polyfill#permissions"),0===s.length)throw new Error(w);await Promise.all(s.map((async t=>{if(!await c.permissions.contains({origins:[t]}))throw new Error(b+t)})));const m=r(...s),d=r(...null!=a?a:[]),p=async(t,e,r=0)=>{m.test(t)&&!d.test(t)&&await async function(t){return c.permissions.contains({origins:[new URL(t).origin+"/*"]})}(t)&&await f({tabId:e,frameId:r},{css:o,js:n,matchAboutBlank:i,runAt:l},{ignoreTargetErrors:!0})},h=async(t,{status:e},{url:n})=>{"loading"===e&&n&&p(n,t)},g=async({tabId:t,frameId:e,url:n})=>{p(n,t,e)};y?chrome.webNavigation.onCommitted.addListener(g):chrome.tabs.onUpdated.addListener(h);const v={async unregister(){y?chrome.webNavigation.onCommitted.removeListener(g):chrome.tabs.onUpdated.removeListener(h)}};return"function"==typeof e&&e(v),v}(e)}const _=new Map;function I(t){return new URL(t,location.origin).pathname}async function E({origins:t}){const{content_scripts:e,manifest_version:n}=chrome.runtime.getManifest();if(!e)throw new Error("webext-dynamic-content-scripts tried to register scripts on the new host permissions, but no content scripts were found in the manifest.");const o=function(t,{warn:e=!0}={}){const n=new Map,o=(t,o)=>t?t.filter((t=>{const r=(i=o,JSON.stringify([i.all_frames,i.exclude_matches,i.run_at]));var i;return n.has(t)?(e&&r!==n.get(t)&&console.warn(`Duplicate file in the manifest content_scripts: ${t} \nMore info: https://github.com/fregante/webext-dynamic-content-scripts/issues/62`),!1):(n.set(t,r),!0)})):[];return t.flatMap((t=>{const{matches:e,...n}=t,r={...n,js:o(t.js,t),css:o(t.css,t)};return r.css.length+r.js.length===0?[]:r}))}(e,{warn:2===n});for(const e of t||[])for(const t of o){const n=k({js:t.js?.map((t=>I(t))),css:t.css?.map((t=>I(t))),allFrames:t.all_frames,matches:[e],excludeMatches:t.matches,runAt:t.run_at});_.set(e,n)}!async function(t,e){const n=e.flatMap((t=>t.matches??[]));f(await async function(t,e){if(0===t.length)return[];const n=e?r(...e):void 0;return(await c.tabs.query({url:t})).filter((t=>t.id&&t.url&&(!n||!n.test(t.url)))).map((t=>t.id))}(t,n),e,{ignoreTargetErrors:!0})}(t||[],o)}function S(t){t.origins&&t.origins.length>0&&E(t)}async function A({origins:t}){if(t&&0!==t.length)for(const[e,n]of _)t.includes(e)&&(await n).unregister()}!async function(){chrome.permissions.onRemoved.addListener(A),chrome.permissions.onAdded.addListener(S),await E(await async function(t){return new Promise((e=>{chrome.permissions.getAll((n=>{const o=i();e(function(t,e,{strictOrigins:n=!0}={}){var o,r;const i={origins:[],permissions:[]};for(const r of null!==(o=e.origins)&&void 0!==o?o:[])if(!t.origins.includes(r)){if(!n){const e=a(r);if(t.origins.some((t=>a(t)===e)))continue}i.origins.push(r)}for(const n of null!==(r=e.permissions)&&void 0!==r?r:[])t.permissions.includes(n)||i.permissions.push(n);return i}(o,n,t))}))}))}({strictOrigins:!1}))}();function T(t){if(!t)return!1;try{const{pathname:e}=new URL(t,location.origin);return e===location.pathname}catch{return!1}}function M(t){return globalThis.chrome?.runtime?.getManifest?.()}function $(t){let e;return()=>(void 0!==e||(e=t()),e)}const L=$((()=>["about:","http:","https:"].includes(location.protocol))),j=$((()=>"object"==typeof globalThis.chrome?.extension)),z=$((()=>j()&&L())),B=()=>F()||C(),F=$((()=>{const t=M();return!(!t||!T(t.background_page??t.background?.page))||Boolean(t?.background?.scripts&&T("/_generated_background_page.html"))})),C=$((()=>T(M()?.background?.service_worker))),O=$((()=>F()&&2===M()?.manifest_version&&!1!==M()?.background?.persistent)),P=$((()=>{const t=M()?.options_ui?.page;return"string"==typeof t&&new URL(t,location.origin).pathname===location.pathname})),R=$((()=>{const t=M()?.side_panel?.default_path;return"string"==typeof t&&new URL(t,location.origin).pathname===location.pathname})),U=$((()=>{const t=j()&&chrome.devtools&&M()?.devtools_page;return"string"==typeof t&&new URL(t,location.origin).pathname===location.pathname})),N=()=>globalThis.navigator?.userAgent.includes("Chrome"),q={contentScript:z,background:B,options:P,sidePanel:R,devTools:()=>Boolean(globalThis.chrome?.devtools),devToolsPage:U,extension:j,web:L};Object.keys(q);const D=/^(https?|wss?|file|ftp|\*):\/\/(\*|\*\.[^*/]+|[^*/]+)\/.*$|^file:\/\/\/.*$|^resource:\/\/(\*|\*\.[^*/]+|[^*/]+)\/.*$|^about:/,J=globalThis.navigator?.userAgent.includes("Firefox/"),W=J?/^(https?|wss?):[/][/][^/]+([/].*)?$/:/^https?:[/][/][^/]+([/].*)?$/,H=/^(https?|file|ftp):[/]+/;function V(...t){return 0===t.length?/$./:t.includes("<all_urls>")?H:t.includes("*://*/*")?W:new RegExp(t.map((t=>function(t){!function(t){if(!function(t){return"<all_urls>"===t||D.test(t)}(t))throw new Error(t+" is an invalid pattern, it must match "+String(D))}(t);let[,e,n="",o]=t.split(/(^[^:]+:[/][/])([^/]+)?/);return e=e.replace("*",J?"(https?|wss?)":"https?").replaceAll(/[/]/g,"[/]"),"*"===n?n="[^/]+":n&&(n=n.replace(/^[*][.]/,"([^/]+.)*").replaceAll(/[.]/g,"[.]").replace(/[*]$/,"[^.]+")),o=o.replaceAll(/[/]/g,"[/]").replaceAll(/[.]/g,"[.]").replaceAll(/[*]/g,".*"),"^"+e+n+"("+o+")?$"}(t))).join("|"))}const G=Boolean(globalThis.chrome?.scripting),K=/^function \w+\(\) {[\n\s]+\[native code][\n\s]+}/;async function Q(t){const{frameId:e,tabId:n}=function(t){return"object"==typeof t?t:{tabId:t,frameId:0}}(t);try{if(0===e&&"tabs"in globalThis.chrome){const t=await c.tabs.get(n);if(t.url)return t.url}return await async function(t,e,...n){if(K.test(String(e)))throw new TypeError("Native functions need to be wrapped first, like `executeFunction(1, () => alert(1))`");const{frameId:o,tabId:r}=function(t){return"object"==typeof t?t:{tabId:t,frameId:0}}(t);if(G){const[t]=await chrome.scripting.executeScript({target:{tabId:r,frameIds:[o]},func:e,args:n});return t?.result}const[i]=await c.tabs.executeScript(r,{code:`(${e.toString()})(...${JSON.stringify(n)})`,matchAboutBlank:!0,frameId:o});return i}(t,(()=>location.href))}catch{return}}new class{#t;#e=new AbortController;get signal(){return this.#t||(this.#t=setInterval((()=>{X()&&(this.#e.abort(),clearInterval(this.#t))}),200)),this.#e.signal}get promise(){return new Promise((t=>{this.addListener(t)}))}addListener(t,{signal:e}={}){!this.signal.aborted||e?.aborted?this.signal.addEventListener("abort",t,{once:!0,signal:e}):setTimeout(t,0)}};const X=()=>!chrome.runtime?.id,Y="__webext-events__startup",Z=new EventTarget;let tt=!1,et=!1;const nt=globalThis.browser?.storage??globalThis.chrome?.storage;function ot(){const t=document.querySelector("button");t.addEventListener("click",(t=>{window.close()})),window.addEventListener("blur",(t=>{window.close()})),window.resizeBy(0,document.body.scrollHeight-window.innerHeight),window.moveTo((screen.width-window.outerWidth)/2,(screen.height-window.outerHeight)/2),t.focus()}Object.freeze({addListener(t){tt?console.warn("onExtensionStart.addListener() was called after the extension started. The callback will not be called."):(et=!0,Z.addEventListener("extension-start",t))},removeListener(t){Z.removeEventListener("extension-start",t)}}),setTimeout((async function(){if(tt=!0,!et)return;if(O())return void Z.dispatchEvent(new Event("extension-start"));if(!nt?.session)return N()&&2===chrome.runtime.getManifest().manifest_version?console.warn("onExtensionStart is unable to determine whether it’s being run for the first time on MV2 Event Pages in Chrome. It will run the listeners anyway."):console.warn("onExtensionStart is unable to determine whether it’s being run for the first time without the `storage` permission. It will run the listeners anyway"),void Z.dispatchEvent(new Event("extension-start"));const t=await nt.session.get(Y);Y in t||(await nt.session.set({[Y]:!0}),Z.dispatchEvent(new Event("extension-start")))}),100);function rt(t=""){return`\n\t\t<!doctype html>\n\t\t<meta charset="utf-8" />\n\t\t<title>${chrome.runtime.getManifest().name}</title>\n\t\t<style>\n\t/*! https://npm.im/webext-base-css */\n\n\t/* Chrome only: -webkit-hyphens */\n\t/* Safari only: _::-webkit-full-page-media */\n\n\t/* webpackIgnore: true */\n\t@import url('chrome://global/skin/in-content/common.css') (min--moz-device-pixel-ratio:0); /* Firefox-only */\n\n\t:root {\n\t\t--background-color-for-chrome: #292a2d;\n\t\tmax-width: 700px;\n\t\tmargin: auto;\n\t}\n\n\tbody {\n\t\t--body-margin-h: 8px;\n\t\tmargin-left: var(--body-margin-h);\n\t\tmargin-right: var(--body-margin-h);\n\t}\n\n\t/* Selector matches Firefox’ */\n\tinput[type='number'],\n\tinput[type='password'],\n\tinput[type='search'],\n\tinput[type='text'],\n\tinput[type='url'],\n\tinput:not([type]),\n\ttextarea {\n\t\tdisplay: block;\n\t\tbox-sizing: border-box;\n\t\tmargin-left: 0;\n\t\twidth: 100%;\n\t\tresize: vertical;\n\t\t-moz-tab-size: 4 !important;\n\t\ttab-size: 4 !important;\n\t}\n\n\tinput[type='checkbox'] {\n\t\tvertical-align: -0.15em;\n\t}\n\n\t@supports (not (-webkit-hyphens:none)) and (not (-moz-appearance:none)) and (list-style-type:'*') {\n\t\ttextarea:focus {\n\t\t\t/* Inexplicably missing from Chrome’s input style https://github.com/chromium/chromium/blob/6bea0557fe/extensions/renderer/resources/extension.css#L287 */\n\t\t\tborder-color: #4d90fe;\n\t\t\ttransition: border-color 200ms;\n\t\t}\n\t}\n\n\thr {\n\t\tmargin-right: calc(-1 * var(--body-margin-h));\n\t\tmargin-left: calc(-1 * var(--body-margin-h));\n\t\tborder: none;\n\t\tborder-bottom: 1px solid #aaa4;\n\t}\n\n\timg {\n\t\tvertical-align: middle;\n\t}\n\n\t_::-webkit-full-page-media,\n\t_:future,\n\t:root {\n\t\tfont-family: -apple-system, BlinkMacSystemFont, sans-serif, 'Apple Color Emoji';\n\t}\n\n\t_::-webkit-full-page-media,\n\t_:future,\n\tinput[type='number'],\n\tinput[type='password'],\n\tinput[type='search'],\n\tinput[type='text'],\n\tinput[type='url'],\n\tinput:not([type]),\n\ttextarea {\n\t\tborder: solid 1px #888;\n\t\tpadding: 0.4em;\n\t\tfont: inherit;\n\t\t-webkit-appearance: none;\n\t}\n\n\t@media (prefers-color-scheme: dark) {\n\t\t:root {\n\t\t\tcolor-scheme: dark;\n\t\t\tbackground-color: var(--background-color-for-chrome);\n\t\t}\n\n\t\tbody,\n\t\th3 { /* Chrome #3 */\n\t\t\tcolor: #e8eaed;\n\t\t}\n\n\t\ta {\n\t\t\tcolor: var(--link-color, #8ab4f8);\n\t\t}\n\n\t\ta:active {\n\t\t\tcolor: var(--link-color-active, #b6d3f9);\n\t\t}\n\n\t\tinput[type='number'],\n\t\tinput[type='password'],\n\t\tinput[type='search'],\n\t\tinput[type='text'],\n\t\tinput[type='url'],\n\t\tinput:not([type]),\n\t\ttextarea {\n\t\t\tcolor: inherit;\n\t\t\tbackground-color: transparent;\n\t\t}\n\t}\n\n\t/* End webext-base-css */\n\n\tbody {\n\t\tbox-sizing: border-box;\n\t\tmin-height: 100vh;\n\t\tmargin: 0;\n\t\tpadding: 1em;\n\t\tjustify-content: center;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tfont-size: 14px;\n\t\tline-height: 1.5;\n\t\tfont-family: system, system-ui, sans-serif;\n\t}\n\n\tbutton {\n\t\tmargin-top: 1em;\n\t\tmargin-left: auto;\n\t}\n</style>\n\t\t<script defer src="alert.js"><\/script>\n\t\t<body>\n\t\t\t<main>${t}</main>\n\t\t\t<button>Ok</button>\n\t\t</body>\n\t\t<script>(${ot.toString()})()<\/script>\n\t`}const it=C()||!N()&&F()?async function(t){const e=await chrome.windows.create({type:"popup",url:"data:text/html,"+encodeURIComponent(rt(t)),focused:!0,height:150,width:420});await async function(t){await async function(t,e){await new Promise((n=>{const o=(...r)=>{e&&!e(...r)||(n(),t.removeListener(o))};t.addListener(o)}))}(chrome.windows.onRemoved,(e=>e===t))}(e.id)}:alert,st=Boolean(globalThis.chrome?.scripting),at=/^function \w+\(\) {[\n\s]+\[native code][\n\s]+}/;async function ct(t,e,...n){if(at.test(String(e)))throw new TypeError("Native functions need to be wrapped first, like `executeFunction(1, () => alert(1))`");const{frameId:o,tabId:r}=function(t){return"object"==typeof t?t:{tabId:t,frameId:0}}(t);if(st){const[t]=await chrome.scripting.executeScript({target:{tabId:r,frameIds:[o]},func:e,args:n});return t?.result}const[i]=await c.tabs.executeScript(r,{code:`(${e.toString()})(...${JSON.stringify(n)})`,matchAboutBlank:!0,frameId:o});return i}const lt=["chrome.google.com/webstore","chromewebstore.google.com","accounts-static.cdn.mozilla.net","accounts.firefox.com","addons.cdn.mozilla.net","addons.mozilla.org","api.accounts.firefox.com","content.cdn.mozilla.net","discovery.addons.mozilla.org","input.mozilla.org","install.mozilla.org","oauth.accounts.firefox.com","profile.accounts.firefox.com","support.mozilla.org","sync.services.mozilla.com","testpilot.firefox.com"];function ut(t){if(!t?.startsWith("http"))return!1;const e=t.replace(/^https?:\/\//,"");return lt.every((t=>!e.startsWith(t)))}const mt="webext-permission-toggle:add-permission";let dt;const pt=N()&&globalThis.chrome?.runtime?.getManifest().manifest_version<3?c:chrome;async function ft(t){return pt.permissions.contains({origins:[t+"/*"]})}function ht({checked:t,enabled:e}){chrome.contextMenus.update(mt,{checked:t,enabled:e})}async function gt(t){if(t)if(ut(t)){const{origin:e}=new URL(t),n=function(t,e=chrome.runtime.getManifest()){return V(...function(t=chrome.runtime.getManifest()){const e={origins:[],permissions:[]},n=new Set([...t.permissions??[],...t.host_permissions??[],...(t.content_scripts??[]).flatMap((t=>t.matches??[]))]);t.devtools_page&&!t.optional_permissions?.includes("devtools")&&n.add("devtools");for(const t of n)t.includes("://")||"<all_urls>"===t?e.origins.push(t):e.permissions.push(t);return function({origins:t,permissions:e}){return{origins:t?(n=t,n.includes("<all_urls>")?["<all_urls>"]:n.includes("*://*/*")?["*://*/*"]:n.filter((t=>!n.some((e=>t!==e&&V(e).test(t)))))):[],permissions:e?[...e]:[]};var n}(e)}(e).origins).test(t)}(t);ht({enabled:!n,checked:n||await ft(e)})}else ht({enabled:!1,checked:!1});else ht({enabled:!0,checked:!1})}async function wt({tabId:t}){gt(await Q(t)??"")}async function bt({checked:t,menuItemId:e},n){if(e!==mt)return;let o;try{!function(t){if(!t?.id)throw new Error("The browser didn't supply any information about the active tab.")}(n),o=n.url??await Q(n.id),function(t){if(!t)throw new Error("The browser didn't supply the current page's URL.")}(o),function(t){if(!ut(t))throw new Error(chrome.runtime.getManifest().name+" can't be enabled on this page.")}(o);const e=await async function(t,e){const n={origins:[new URL(t).origin+"/*"]};return await pt.permissions[e?"request":"remove"](n),pt.permissions.contains(n)}(o,t);e===t||ht({checked:e}),e&&dt.reloadOnSuccess&&ct(n.id,(t=>{confirm(t)&&location.reload()}),dt.reloadOnSuccess)}catch(t){if(setTimeout(gt,500,o),n?.id)try{await ct(n.id,(t=>{window.alert(t)}),String(t))}catch{it(String(t))}throw t}}browser.runtime.onMessage.addListener(((t,e,n)=>{if("octotree_send_request"===t.eventName)return async function({method:t,path:e,body:n,token:o},r){try{const i={"Content-Type":"application/json"};o&&(i.Authorization=`Bearer ${o}`);const s=await fetch(`https://www.octotree.io/api/v1.0/${e.replace(/^\//,"")}`,{headers:i,body:n,method:t}),a=s.headers.get("Content-Type");let c;if(c=/application\/json/i.test(a)?await s.json():await s.text(),!s.ok){const t=new Error(c.message||c.statusText||c);throw t.statusCode=s.status,t}r({responseBody:c,responseStatus:s.status})}catch(t){r({message:t.message,statusCode:t.statusCode})}}(t,n),!0;n()})),function(t){if(!B())throw new Error("webext-permission-toggle can only be called from a background page");if(dt)throw new Error("webext-permission-toggle can only be initialized once");const e=chrome.runtime.getManifest();if(!e.permissions?.includes("contextMenus"))throw new Error("webext-permission-toggle requires the `contextMenus` permission");if(!chrome.contextMenus)return void console.warn("chrome.contextMenus is not available");dt={title:`Enable ${e.name} on this domain`,reloadOnSuccess:!1,reloadOnSuccess:!0},!0===dt.reloadOnSuccess&&(dt.reloadOnSuccess=`Do you want to reload this page to apply ${e.name}?`);const n=[...e.optional_permissions??[],...e.optional_host_permissions??[]].filter((t=>"<all_urls>"===t||t.includes("*")));if(0===n.length)throw new TypeError("webext-permission-toggle requires some wildcard hosts to be specified in `optional_permissions` (MV2) or `optional_host_permissions` (MV3)");chrome.contextMenus.remove(mt,(()=>chrome.runtime.lastError));const o=2===e.manifest_version?["page_action","browser_action"]:["action"];chrome.contextMenus.create({id:mt,type:"checkbox",checked:!1,title:dt.title,contexts:o,documentUrlPatterns:n}),chrome.contextMenus.onClicked.addListener(bt),chrome.tabs.onActivated.addListener(wt),chrome.tabs.onUpdated.addListener((async(t,{status:e},{url:n,active:o})=>{o&&"complete"===e&&gt(n??await Q(t)??"")}))}()})();